<!DOCTYPE html>
<html id="docs" lang="en" class="">
	<head>
	<meta charset="utf-8">
<title>With your own Docker image - CDS - Continuous Delivery Service</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" type="image/png" href="../../../../images/favicon.png">




<link rel="stylesheet" href="../../../../sass/styles.css" integrity="" media="screen">
<link rel="stylesheet" href="../../../../css/callouts.css">
<link rel="stylesheet" href="../../../../css/auto-complete.css">
<link rel="stylesheet" href="../../../../css/fontawesome.min.css">
<link rel="stylesheet" href="../../../../css/asciinema-player.css">
<link rel="stylesheet" href="../../../../css/solarized-light.css">

<meta name="description"
    content="A worker model of type docker can be spawned by a Hatchery Docker Swarm
Setup Docker Worker Model with your own image In this example, we will build a Docker model able to build an AngularJS application with webfonts. To create webfonts, a grunt task (optionally) requires fontforge and ttfautohint.
The following tools must be included in the model:
 Node.js and npm bower grunt-cli gulp-cli fontforge ttfautohint  We will use the official nodejs image from Docker.">
<meta property="og:description"
    content="A worker model of type docker can be spawned by a Hatchery Docker Swarm
Setup Docker Worker Model with your own image In this example, we will build a Docker model able to build an AngularJS application with webfonts. To create webfonts, a grunt task (optionally) requires fontforge and ttfautohint.
The following tools must be included in the model:
 Node.js and npm bower grunt-cli gulp-cli fontforge ttfautohint  We will use the official nodejs image from Docker.">
<meta name="twitter:description"
    content="A worker model of type docker can be spawned by a Hatchery Docker Swarm
Setup Docker Worker Model with your own image In this example, we will build a Docker model able to build an AngularJS application with webfonts. To create webfonts, a grunt task (optionally) requires fontforge and ttfautohint.
The following tools must be included in the model:
 Node.js and npm bower grunt-cli gulp-cli fontforge ttfautohint  We will use the official nodejs image from Docker.">
<meta property="og:url" content="/docs/tutorials/worker_model-docker/docker-customized/">
<meta property="og:title" content="With your own Docker image">
<meta name="twitter:title" content="With your own Docker image">
<meta name="twitter:image:alt" content="CDS - Continuous Delivery Service">
<meta property="og:image" content="/images/cds-transparent.png">
<script type="text/javascript" src="../../../../js/anchor.min.js"></script>
<script type="text/javascript" src="../../../../js/jquery.min.js"></script>
<script type="text/javascript" src="../../../../js/jquery-ui.min.js"></script>
<script type="text/javascript" src="../../../../js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../../../js/highlight.pack.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>
<script type="text/javascript" src="../../../../js/script.js"></script>
<script type="text/javascript" src="../../../../js/lunr.min.js"></script>
<a id="indexJSON" href="../../../../index.json"></a>

<script type="text/javascript" src="../../../../js/auto-complete.min.js"></script>
<script type="text/javascript" src="../../../../js/search.js"></script>
<script type="text/javascript" src="../../../../js/asciinema-player.min.js"></script>

	</head>
	<body>
		<section id="hero" class="light-text no-sub">
			<a href="../../../../" class="logo"></a>
				<i id="tocburger" class="fa fa-bars" onclick='$("#toc").toggle()'></i><div class="nav-buttons" data-auto-burger="primary">
				<ul class="global-nav">
					
					
					<li><a href="../../../../docs/" class="active">Documentation</a></li>
					
					<li><a href="../../../../hosting/">Hosting your own instance</a></li>
					
					<li><a href="../../../../development/">CDS Developer Manual</a></li>
					
					<li><a href="../../../../about/">About</a></li>
					
					<li><i class="fa fa-search" onclick='$("#searchbox").toggle(); $("#search-query").focus().select()'></i></li>
					<li>
						<div id="btn-gh">
							<a class="github-button" href="https://github.com/ovh/cds" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star CDS on GitHub">Star</a>
							<script async defer src="https://buttons.github.io/buttons.js"></script>
						</div>
					</li>
				</ul>
				<div id="searchbox">
					<input data-search-input id="search-query" type="text" placeholder="search...">
					<span data-search-clear=""><i class="fa fa-close"></i></span>
				</div>
			</div>

<div id="headSubMenu" class="light-text">




	

		

		
		<ul>
			
			
			
			<li><a href="../../../../docs/">Home</a></li>
			
			
				
				<li><a href="../../../../docs/concepts/">Concepts</a></li>
			
				
				<li><a href="../../../../docs/actions/">Actions</a></li>
			
				
				<li><a href="../../../../docs/components/">Components</a></li>
			
				
				<li><a href="../../../../docs/integrations/">Integrations</a></li>
			
				
				<li><a href="../../../../docs/tutorials/" class="menuSelected">Tutorials</a></li>
			
		</ul>
		
	

	

		

		
	

	

		

		
	

	

		

		
	

</div>


		</section>
		<section id="page-content-with-menu">
			
<div id="toc">
     <div class="toc-container">
        
        
        
        
        
            
                
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                            
                        
                    
                        
                            
                                    
                                    
                            
                        
                    
                
            
        
            
                
                    
                        
                    
                        
                    
                
            
        
            
                
                    
                        
                    
                        
                    
                        
                    
                
            
        
            
                
                    
                
            
        
        
        <i class="fa fa-bars" id="tocburger" onclick='$("#toc").toggle()'></i> 
<a class="item" data-title="Tutorials" href="../../../../docs/tutorials/"></a>

	
	
	
	
		
			
<a class="item" data-title="Init a CDS Workflow from a repository" href="../../../../docs/tutorials/init_workflow_with_cdsctl/"></a>

		
	
		
			
<a class="item" data-title="Import a CDS Workflow from a repository" href="../../../../docs/tutorials/import_workflow_with_webui/"></a>

		
	
		
			
<a class="item" data-title="Service Requirement NGINX" href="../../../../docs/tutorials/service-requirement-nginx/"></a>

		
	
		
			
<a class="item" data-title="Build &amp; Deploy a standard application" href="../../../../docs/tutorials/step_by_step_build_deploy/"></a>

		
	
		
			
<a class="item" data-title="Service Requirement PostgreSQL" href="../../../../docs/tutorials/service-requirement-pg/"></a>

		
	
		
			
<a class="item" data-title="Build, tag and release an application" href="../../../../docs/tutorials/step_by_step_build_tag_release/"></a>

		
	
		
			
<div class="item" data-title="Worker Model Docker">
	<div class="container">
		
		<a class="item" data-title="Worker Model Docker" href="../../../../docs/tutorials/worker_model-docker/"></a>
		
		
	
	
	
	
		
			
<a class="item" data-title="With your own Docker image" href="../../../../docs/tutorials/worker_model-docker/docker-customized/"></a>

		
	

	</div>
</div>

		
	
		
			
<a class="item" data-title="Worker Model OpenStack" href="../../../../docs/tutorials/worker_model-openstack/"></a>

		
	
		
			
<a class="item" data-title="Worker Model vSphere" href="../../../../docs/tutorials/worker_model-vsphere/"></a>

		
	





     </div>
</div>


			<div id="docsContent">
        		

<h1>With your own Docker image</h1>



<nav id="TableOfContents"></nav>

<p>A worker model of type <code>docker</code> can be spawned by a Hatchery Docker Swarm</p>
<h1 id="setup-docker-worker-model-with-your-own-image">Setup Docker Worker Model with your own image</h1>
<p>In this example, we will build a Docker model able to build an AngularJS application with webfonts. To create webfonts, a <code>grunt</code> task (optionally) requires <code>fontforge</code> and <code>ttfautohint</code>.</p>
<p>The following tools must be included in the model:</p>
<ul>
<li><code>Node.js</code> and <code>npm</code></li>
<li><code>bower</code></li>
<li><code>grunt-cli</code></li>
<li><code>gulp-cli</code></li>
<li><code>fontforge</code></li>
<li><code>ttfautohint</code></li>
</ul>
<p>We will use the official <strong>nodejs</strong> image from Docker. In this image, there is already a user named <strong>node</strong>. For the example, we will compile <code>ttfautohint</code>.</p>
<h1 id="prerequisite">Prerequisite</h1>
<p>To build a Docker model, you need:</p>
<ul>
<li>your favorite text editor</li>
<li>a sane installation of Docker <a href="https://docs.docker.com/engine/installation/">https://docs.docker.com/engine/installation/</a></li>
</ul>
<h1 id="dockerfile">Dockerfile</h1>
<p>Copy this content in a file named <code>Dockerfile</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#75715e"># User official Node.js Docker image</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> node:6.10.1</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">#Answer &#39;yes&#39; to each question</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ENV</span> DEBIAN_FRONTEND noninteractive<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Upgrade the debian packages</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> <span style="color:#f92672">(</span>apt-get update <span style="color:#f92672">&amp;&amp;</span> apt-get upgrade -y -q <span style="color:#f92672">&amp;&amp;</span> apt-get -y -q autoclean <span style="color:#f92672">&amp;&amp;</span> apt-get -y -q autoremove<span style="color:#f92672">)</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">#The official image comes with npm; so we can use it to install some packages</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> npm install -g grunt-cli gulp-cli bower<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Install fontforge for our specific need</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> apt-get install -y fontforge<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Install packages and compile ttfautohint (still for our specific need)</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> apt-get install -y libharfbuzz-dev libfreetype6-dev libqt4-dev<span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> cd /tmp <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> curl -L http://download.savannah.gnu.org/releases/freetype/ttfautohint-1.6.tar.gz |tar xz<span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> cd ttfautohint-1.6<span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> ./configure<span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> make<span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#f92672">&amp;&amp;</span> make install<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Change user. If you do not specify this command, the user will be root, and in our case,</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Bower will shout as it cannot be launched by root</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">USER</span><span style="color:#e6db74"> node</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Specify a working directory on which the current user has write access</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Remember, a curl command will be, first, executed to download the worker</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /home/node</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><h1 id="build-it-and-push-it">Build it and push it</h1>
<p>from you shell, type the following command to build the Docker image:</p>
<pre><code>docker build --no-cache --pull -t registry.my.infra.net/my/beautiful/worker:latest .
</code></pre><p>If you want to test it, you can launch your Docker in bash mode:</p>
<pre><code>docker run -it registry.my.infra.net/my/beautiful/worker:latest /bin/bash
pwd
fontforge -v
exit
</code></pre><p>Now push it</p>
<pre><code>docker push registry.my.infra.net/my/beautiful/worker:latest
</code></pre><h1 id="register-your-model-in-cds">Register your model in CDS</h1>
<ul>
<li>In the UI, click on the wheel on the hand right top corner and select *workers&quot; (or go the the route <em>#/worker</em>)</li>
<li>At the bottom of the page, fill the form
<ul>
<li><strong>Name</strong> of your worker <em>My Beautiful</em></li>
<li><strong>type</strong> <em>docker</em></li>
<li><strong>image</strong> <em>registry.my.infra.net/my/beautiful/worker:latest</em></li>
<li><strong>pattern</strong>: if you aren&rsquo;t an administrator select a pattern for your configuration script (CDS provide default pattern for Linux environment called basic_unix)</li>
<li><strong>shell command</strong>: if you are an administrator in the main shell command you can indicate <code>sh -c</code> for a Unix environment.</li>
<li><strong>command</strong>: is the main worker command, typically on a Unix system <code>curl {{.API}}/download/worker/linux/$(uname -m) -o worker --retry 10 --retry-max-time 120 -C - &amp;&amp; chmod +x worker &amp;&amp; exec ./worker</code> to see all the available variables to interpolate for your worker parameters <a href="../../../../docs/concepts/worker-model/variables/">click here</a></li>
</ul>
</li>
<li>Click on <em>Add</em> button and that&rsquo;s it</li>
</ul>
<p>Now you can specify this model in prerequisite on your job. Create a new prerequisite of type &ldquo;model&rdquo;, then choose your worker model in list</p>

<blockquote class="note">
    <div><strong></strong> If you want to specify an image using a private registry or a private image. You need to check the private checkbox and fill credentials in username and password to access to your image. And if your image is not on docker hub but from a private registry you need to fill the registry info (the registry api url, for example for docker hub it&rsquo;s <a href="https://index.docker.io/v1/">https://index.docker.io/v1/</a> but we fill it by default).</div>
</blockquote>





			</div>
		</section><footer>
			<main>
			<a href="https://www.ovh.com"><img src="https://ovh.github.io/cds/images/logo-ovh-white-72DPI.png"></a>
			<div>
				The CDS logos are copyrighted.
				Icons made by <a href="https://www.flaticon.com/authors/eucalyp">Eucalyp</a> 
				from <a href="https://www.flaticon.com/">www.flaticon.com</a>
			</div>
			</main>
		</footer>

	</body>
</html>
